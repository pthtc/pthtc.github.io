<!DOCTYPE html>
<html>
    <head>
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.2.6 -->

    <!-- Title -->
    
    <title>
        
            计算机系统结构笔记 | 
        
        彭天浩的博客
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/head.jpg">
    <link rel="icon" sizes="192x192" href="/img/head.jpg">
    <link rel="apple-touch-icon" href="/img/head.jpg">

    <!-- Meta & Info -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="彭天浩">
    <meta name="description" content="手持两把锟斤拷,口中高呼烫烫烫">
    <meta name="keywords" content="“彭天浩”">

    <!--iOS -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="彭天浩的博客">

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://pengtianhao.com">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="计算机系统结构笔记 | 彭天浩的博客">
    <meta property="og:description" content="手持两把锟斤拷,口中高呼烫烫烫">

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import CSS -->
    <link rel="stylesheet" href="/css/material.min.css">
    <link rel="stylesheet" href="/css/style.min.css">
    <!-- Config CSS -->


<!-- Other Styles -->
<style>
    body, html {
        font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
    }

    a {
        color: #00838F;
    }

    .mdl-card__media,
    #search-label,
    #search-form-label:after,
    #scheme-Paradox .hot_tags-count,
    #scheme-Paradox .sidebar_archives-count,
    #scheme-Paradox .sidebar-colored .sidebar-header,
    #scheme-Paradox .sidebar-colored .sidebar-badge{
        background-color: #0097A7 !important;
    }

    /* Sidebar User Drop Down Menu Text Color */
    #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
    #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
        color: #0097A7 !important;
    }

    #post_entry-right-info,
    .sidebar-colored .sidebar-nav li:hover > a,
    .sidebar-colored .sidebar-nav li:hover > a i,
    .sidebar-colored .sidebar-nav li > a:hover,
    .sidebar-colored .sidebar-nav li > a:hover i,
    .sidebar-colored .sidebar-nav li > a:focus i,
    .sidebar-colored .sidebar-nav > .open > a,
    .sidebar-colored .sidebar-nav > .open > a:hover,
    .sidebar-colored .sidebar-nav > .open > a:focus,
    #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
        color: #0097A7 !important;
    }

    .toTop {
        background: #757575 !important;
    }

    .material-layout .material-post>.material-nav,
    .material-layout .material-index>.material-nav,
    .material-nav a {
        color: #757575;
    }

    #scheme-Paradox .MD-burger-layer {
        background-color: #757575;
    }

    #scheme-Paradox #post-toc-trigger-btn {
        color: #757575;
    }

    .post-toc a:hover {
        color: #00838F;
        text-decoration: underline;
    }
</style>


<!-- Theme Background Related-->

    <style>
        body{
            background-color: #F5F5F5;
        }

        /* blog_info bottom background */
        #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
            background-color: #fff;
        }
    </style>




<!-- Fade Effect -->

    <style>
        .fade {
            transition: all 800ms linear;
            -webkit-transform: translate3d(0,0,0);
            -moz-transform: translate3d(0,0,0);
            -ms-transform: translate3d(0,0,0);
            -o-transform: translate3d(0,0,0);
            transform: translate3d(0,0,0);
            opacity: 1;
        }

        .fade.out{
            opacity: 0;
        }
    </style>


    <script src="/js/jquery.min.js"></script>

    <link rel="stylesheet" href="/css/highlight/solarized-white.css">

    <!-- UC Browser Compatible-->
    <script>
        var agent = navigator.userAgent.toLowerCase();
        if(agent.indexOf('ucbrowser')>0) {
            document.write('<link rel="stylesheet" href="/css/uc.css">');
            alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
        }
    </script>

    <!-- Custom Head -->
    
</head>


    
        <body id="scheme-Paradox">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->

    <!-- Left aligned menu below button -->
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#量化设计与分析基础"><span class="post-toc-number">1.</span> <span class="post-toc-text">量化设计与分析基础</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#计算机体系结构定义"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">计算机体系结构定义</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Flynn分类"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">Flynn分类</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#量化设计原理"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">量化设计原理</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Amdal定律"><span class="post-toc-number">1.3.1.</span> <span class="post-toc-text">Amdal定律</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#CPU性能公式"><span class="post-toc-number">1.3.2.</span> <span class="post-toc-text">CPU性能公式</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#性能测试"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">性能测试</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#存储器层次结构"><span class="post-toc-number">2.</span> <span class="post-toc-text">存储器层次结构</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#cache原理"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">cache原理</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#cache优化"><span class="post-toc-number">2.1.1.</span> <span class="post-toc-text">cache优化</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#存储器技术与优化"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">存储器技术与优化</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#虚拟存储-虚拟机"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">虚拟存储/虚拟机</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#虚拟存储器"><span class="post-toc-number">2.3.1.</span> <span class="post-toc-text">虚拟存储器</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#虚拟机VM"><span class="post-toc-number">2.3.2.</span> <span class="post-toc-text">虚拟机VM</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#指令级并行"><span class="post-toc-number">3.</span> <span class="post-toc-text">指令级并行</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#指令级并行概念"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">指令级并行概念</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#数据相关和冒险"><span class="post-toc-number">3.1.1.</span> <span class="post-toc-text">数据相关和冒险</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#数据相关"><span class="post-toc-number">3.1.1.1.</span> <span class="post-toc-text">数据相关</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#名字相关"><span class="post-toc-number">3.1.1.2.</span> <span class="post-toc-text">名字相关</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#控制相关"><span class="post-toc-number">3.1.1.3.</span> <span class="post-toc-text">控制相关</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#数据冒险"><span class="post-toc-number">3.1.1.4.</span> <span class="post-toc-text">数据冒险</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#支持指令级并行的基本编译技术"><span class="post-toc-number">3.1.2.</span> <span class="post-toc-text">支持指令级并行的基本编译技术</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#基本流水线调度"><span class="post-toc-number">3.1.2.1.</span> <span class="post-toc-text">基本流水线调度</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#循环展开"><span class="post-toc-number">3.1.3.</span> <span class="post-toc-text">循环展开</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#采用预测技术减小转移开销"><span class="post-toc-number">3.1.4.</span> <span class="post-toc-text">采用预测技术减小转移开销</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#采用动态调度克服数据冒险"><span class="post-toc-number">3.1.5.</span> <span class="post-toc-text">采用动态调度克服数据冒险</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#用Tomasulo方法进行动态调度"><span class="post-toc-number">3.1.5.1.</span> <span class="post-toc-text">用Tomasulo方法进行动态调度</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#说人话"><span class="post-toc-number">3.1.5.1.1.</span> <span class="post-toc-text">说人话</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#官方解释"><span class="post-toc-number">3.1.5.1.2.</span> <span class="post-toc-text">官方解释</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#数据级并行"><span class="post-toc-number">4.</span> <span class="post-toc-text">数据级并行</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#线程级并行"><span class="post-toc-number">5.</span> <span class="post-toc-text">线程级并行</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#请求级并行"><span class="post-toc-number">6.</span> <span class="post-toc-text">请求级并行</span></a></li></ol>

        <!--
        <li class="mdl-menu__item">
            Some Action
        </li>
        -->
    </ul>




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script>
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').css('background-image', 'url(' + '/img/random/material-' + randomNum + '.png' + ')');
</script>

        
    
            <p class="article-headline-p">
                计算机系统结构笔记
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/head.jpg" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>彭天浩</strong>
        <span>4月 12, 2017</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/基础/">基础</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/计算机系统结构/">计算机系统结构</a>
    </ul>
    

    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    
        
            <!-- Busuanzi Views -->
            <a class="post_share-link" href="#">
                <li class="mdl-menu__item">
                    <span id="busuanzi_container_page_pv">
                        <span id="busuanzi_value_page_pv"></span>&nbsp;浏览量
                    </span>
                </li>
            </a>
        
    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=计算机系统结构笔记&url=http://pengtianhao.com//2017/04/12/计算机系统结构笔记/index.html&pic=&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=计算机系统结构笔记&url=http://pengtianhao.com//2017/04/12/计算机系统结构笔记/index.html&via=彭天浩" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://pengtianhao.com//2017/04/12/计算机系统结构笔记/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=http://pengtianhao.com//2017/04/12/计算机系统结构笔记/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    
        <a class="post_share-link" href="http://connect.qq.com/widget/shareqq/index.html?site=彭天浩的博客&title=计算机系统结构笔记&summary=手持两把锟斤拷,口中高呼烫烫烫&pics=http://pengtianhao.com/img/head.jpg&url=http://pengtianhao.com/2017/04/12/计算机系统结构笔记/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 QQ
            </li>
        </a>
    

    <!-- Share Telegram -->
    
</ul>

</div>

                

                <!-- Post Content -->
                <div id="post-content" class="markdown-Plain mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <blockquote>
<p>计算机系统结构笔记</p>
</blockquote>
<h1 id="量化设计与分析基础"><a href="#量化设计与分析基础" class="headerlink" title="量化设计与分析基础"></a>量化设计与分析基础</h1><h2 id="计算机体系结构定义"><a href="#计算机体系结构定义" class="headerlink" title="计算机体系结构定义"></a>计算机体系结构定义</h2><p>指令集体系结构<br>组成或微体系结构<br>硬件</p>
<p>ILP: 指令级并行<br>TLP：数据并行<br>DLP：处理器并行<br>RLP：请求并行<br><strong>ILP隐式并行，对用户透明，由硬件和编译器实现</strong><br><strong>DLP、TLP、RLP显示并行，程序员新增的负担</strong></p>
<p><strong>五种主流计算平台</strong> 嵌入式/个人移动设备/桌面计算/服务器/集群/仓库级计算</p>
<p><img src="https://d2ppvlu71ri8gs.cloudfront.net/items/0q0m0I0V2w411l2P0B0F/B633890B-969C-4BB7-BEC0-8BADA6E88A95.png?v=ea017f4d" alt=""></p>
<h2 id="Flynn分类"><a href="#Flynn分类" class="headerlink" title="Flynn分类"></a>Flynn分类</h2><ul>
<li><strong>单指令单数据流(SISD)</strong> SISD其实就是传统的顺序执行的单处理器计算机，其指令部件每次只对一条指令进行译码，并只对一个操作部件分配数据。流水线方式的单处理机有时也被当成SISD。</li>
<li><strong>单指令多数据流(SIMD)</strong> 各处理机以同步的形式执行同一条指令</li>
<li><strong>多指令单数据流(MISD)</strong> 被证明不可能,至少是不实际</li>
<li><strong>多指令多数据流(MIMD)</strong> 能够实现作业,任务,指令等各级全面并行</li>
</ul>
<h2 id="量化设计原理"><a href="#量化设计原理" class="headerlink" title="量化设计原理"></a>量化设计原理</h2><ul>
<li><strong>充分利用并行</strong></li>
<li><strong>局域性原理</strong> 通过最近访问的指令和数据，预测未来要用的内容程序经常重复使用最近用过的数据或指令</li>
<li><strong>二八法则</strong> 优先优化常见情景</li>
<li><strong>Amdal定律</strong> 计算通过改进计算机某一部分之后可获得的性能增益</li>
<li><strong>处理器性能公式</strong> </li>
</ul>
<h3 id="Amdal定律"><a href="#Amdal定律" class="headerlink" title="Amdal定律"></a>Amdal定律</h3><p><img src="https://d2ppvlu71ri8gs.cloudfront.net/items/2N3h230P2d293F1M381h/E11187F0-F9F0-4680-82EE-AA919C2DFE38.png?v=e382e7e3" alt=""></p>
<h3 id="CPU性能公式"><a href="#CPU性能公式" class="headerlink" title="CPU性能公式"></a>CPU性能公式</h3><p><code>CPU时间 = 指令数*一条指令的所需周期*时钟周期时间</code></p>
<h2 id="性能测试"><a href="#性能测试" class="headerlink" title="性能测试"></a>性能测试</h2><p>基准测试<br>实际程序<br>玩具程序<br>合成基准测试程序</p>
<p>桌面基准测试SPEC CPU 206<br>服务器基准测试SPECrate</p>
<h1 id="存储器层次结构"><a href="#存储器层次结构" class="headerlink" title="存储器层次结构"></a>存储器层次结构</h1><p><strong>存储性能增长</strong> 落后于处理器/多核要求高带宽</p>
<h2 id="cache原理"><a href="#cache原理" class="headerlink" title="cache原理"></a>cache原理</h2><p>先在缓冲中查找，如果命中，返回值，如果没命中，在下一层中查找，并<strong>装载到缓冲中</strong></p>
<ul>
<li><strong>块如何放置</strong> 直接映射、全相连映射（full association map）、多路组映射</li>
</ul>
<p><img src="https://d2ppvlu71ri8gs.cloudfront.net/items/2b033A451g0Z0C0z2W2y/476BDE10-A27F-4FE8-BFD3-EA1684302283.png?v=dfe612ed" alt=""></p>
<ul>
<li><strong>置换</strong> LRU 最近最少使用、<strong>FIFO</strong> 先进先出、随机</li>
<li><strong>存储器平均访问时间</strong> <code>T = 命中时间 + 缺失率 * 缺失代价</code> </li>
<li><strong>写策略</strong></li>
</ul>
<p><strong>写透（write-through）</strong> 写入缓冲中的块和下一级存储器中的块</p>
<p><strong>写回（write-back）</strong> 只改写缓冲区中的块，修改的值仅在置换出缓冲区时才写到主存储器</p>
<ul>
<li><p><strong>写入缺失</strong></p>
<p>  写入分派：发生写入缺失时将该块读入缓冲区，再执行写入操作<br>  无写入分派：只修改下一级存储器中的块</p>
</li>
</ul>
<p><strong>缺失类别</strong></p>
<pre><code>强制缺失：第一次引用时的缺失，又称冷启动缺失或首次引用缺失
容量缺失：缓冲无法容纳执行期间所需要的全部块，因此一些块要置换
冲突缺失：直接映射或多路组映射实现中，多个块映射到同一个缓存块，或组中缓冲满
</code></pre><p><strong>降低缺失损失</strong></p>
<pre><code>降低缺失率: 较大的块、较大的缓存、较高的关联度
降低缺失代价: 多级缓存、读操作优先于写操作
缩短在缓冲中命中时间: 在索引缓存时避免地址转换
</code></pre><h3 id="cache优化"><a href="#cache优化" class="headerlink" title="cache优化"></a>cache优化</h3><p><strong>基本方法</strong></p>
<ol>
<li>增大块大小以降低缺失率</li>
<li>增大缓存以降低缺失率</li>
<li>提高关联度以降低缺失率（多路）</li>
<li>采用多级缓存降低缺失代价</li>
<li>读缺失的优先级高于写缺失，以降低缺失代价</li>
<li>避免在索引缓存期间进行地址转换，以缩短命中时间</li>
</ol>
<p><strong>高级方法</strong></p>
<ol>
<li><strong>小而简单的第一级缓存，以缩短命中时间、功耗</strong></li>
<li><strong>采用路预测以缩短命中时间</strong>：在缓存中保留一些位，用于预测下一次缓存访问组中的路或块，即优先访问这些预测的块。如果预测正确，则访问延迟为这一次快速命中时间；如果预测不正确，则尝试其他块，并修改路预测模块</li>
<li><strong>实现缓存访问的流水线，以提高缓存带宽</strong>：将cache访问流水线化，这样使得多个访问重叠进行，从而提高带宽</li>
<li><strong>采用无阻塞缓存，以提高缓存带宽</strong>：在运行乱序执行的机器上，处理器不必因一次数据缓存缺失而停顿，相关继续允许后序的缓存访问</li>
<li><strong>采用多种缓存以提高缓存带宽</strong>：将缓存划分为几个相互独立、支持同时访问的缓存组<br>如果访问分布在缓存组之间，则效果最佳</li>
<li><strong>关键字优先和提前启动以降低缺失代价</strong>： 不需要等待一个缓存块完整载入，而是在需要的数据载入后立刻发送给处理器</li>
<li><strong>合并缓冲区以降低缺失代价</strong>：写操作时先写缓冲区，如写缓冲区已有数据，则比较其是否与当前数据的地址所在块是否相同，相同的话则合并。写合并还可以减少写缓冲满时带来的延迟</li>
<li><strong>采用编译器优化以降低缺失率</strong></li>
<li><strong>对指令和数据进行硬件预取，以降低缺失代价或缺失率</strong></li>
<li><strong>用编译器控制预取，以降低缺失代价或缺失率</strong></li>
</ol>
<h2 id="存储器技术与优化"><a href="#存储器技术与优化" class="headerlink" title="存储器技术与优化"></a>存储器技术与优化</h2><p>SRAM 静态的随机存取存储器，加电情况下，不需要刷新，数据不会丢失<br>DRAM 动态随机存取存储器，需要不断的刷新，才能保存数据<br>SDRAM 同步的DRAM,即数据的读写需要时钟来同步<br>闪存<br>PRAM 可编程随机存取存储器</p>
<h2 id="虚拟存储-虚拟机"><a href="#虚拟存储-虚拟机" class="headerlink" title="虚拟存储/虚拟机"></a>虚拟存储/虚拟机</h2><p><strong>虚拟内存可提供进程之间的隔离和保护:</strong> 使进程拥有自己的分页表，指向存储器的不同页面，避免相互损害</p>
<p><strong>分页</strong> 采用固定大小的块，有页编号和页偏移量，查找页表获取主存页首物理地址<br><strong>分段</strong> 采用可变大小的块</p>
<h3 id="虚拟存储器"><a href="#虚拟存储器" class="headerlink" title="虚拟存储器"></a>虚拟存储器</h3><p>TLB是一个小的，虚拟寻址的缓存，其中每一行都保存着一个由单个PTE(Page Table Entry,页表项)组成的块。如果没有TLB，则每次取数据都需要两次访问内存，即查页表获得物理地址和取数据。</p>
<p><code>虚拟地址&lt;64位&gt; → 虚拟页编号&lt;51&gt;+页偏移量&lt;13&gt;</code></p>
<p><img src="https://d2ppvlu71ri8gs.cloudfront.net/items/2E1q423b2a431k3a2R0y/AA8369EF-6286-4425-AD28-87C6A0F00CC7.png?v=1c0a2cb5" alt=""></p>
<p>首先要访问页表，再访问所对应的实际物理内存,利用TLB（Translation Lookaside Block）来cache页表项，减少访问页表的延迟</p>
<p><img src="https://d2ppvlu71ri8gs.cloudfront.net/items/2L033b3F2Z1T3r0r3j3Y/0F089D5D-D640-417F-8D3D-20912C71831F.png?v=566626a4" alt=""></p>
<p><img src="https://d2ppvlu71ri8gs.cloudfront.net/items/2B3X3K3M3v030S1Y3K2N/8F9A04D3-06E7-407E-B9AC-975453119BA8.png?v=117a4c78" alt=""></p>
<p><img src="https://d2ppvlu71ri8gs.cloudfront.net/items/121H0Z2I0t0428123m3G/B58AC9A3-3FD2-4575-AB7A-9CF1CA9A5F0D.png?v=4d73dbe4" alt=""></p>
<h3 id="虚拟机VM"><a href="#虚拟机VM" class="headerlink" title="虚拟机VM"></a>虚拟机VM</h3><p>虚拟机包括所有提供标准软件接口的仿真方法，比如JAVA VM<br>为虚拟机提供支持的软件成为<strong>虚拟机监视器VMM</strong>,决定了如何将虚拟资源映射到物理资源</p>
<p><strong>虚拟机对虚拟内存和I/O的影响</strong> 因为虚拟机有自己的虚拟内存(虚拟的虚拟)，因此需要区分<strong>虚拟存储器、实际存储器、物理存储器</strong>，实际存储器在虚拟机看来就是物理存储器，是两端的中介，VMM页表将来宾存储器银蛇到物理存储器。</p>
<h1 id="指令级并行"><a href="#指令级并行" class="headerlink" title="指令级并行"></a>指令级并行</h1><p><strong>概念</strong> 处理器采用流水线方式使指令的执行可以重叠进行，可以将指令间的关系看做是并行的，是一种指令间潜在的重叠</p>
<p><strong>指令级并行方法分为两类：</strong></p>
<ol>
<li>依赖于硬件，占主导，动态地发现和开发指令级并行</li>
<li>依赖于软件技术，在编译阶段静态地发现并行。</li>
</ol>
<h2 id="指令级并行概念"><a href="#指令级并行概念" class="headerlink" title="指令级并行概念"></a>指令级并行概念</h2><p><strong>循环级并行</strong> 为了提高指令级并行，最常用的方法是将一个循环中的各次迭代并行执行。在循环中，每个迭代可以与其他任何一次迭代重叠执行，在每次迭代内部没有重叠。</p>
<h3 id="数据相关和冒险"><a href="#数据相关和冒险" class="headerlink" title="数据相关和冒险"></a>数据相关和冒险</h3><ul>
<li><strong>两条指令是并行的</strong> 是指流水线有充足资源的情况下，这两条指令可以在任意深度的流水线上并行执行而不会产生停顿。</li>
<li><strong>两条指令是相关的</strong> 是指它们只能以顺序的方式执行，尽管它们之间只存在部分重叠。</li>
</ul>
<p><strong>相关有三种不同的类型</strong>：数据相关、名字相关、控制相关</p>
<h4 id="数据相关"><a href="#数据相关" class="headerlink" title="数据相关"></a>数据相关</h4><p>数据相关的两条指令是不能同时执行或完全重叠的，相关意味着在两条指令之间可能可能存在一条由一个或多个数据冒险组成的相关链；同时执行数据相关的指令会使内部互锁流水线的处理器检测到冒险，造成停顿，从而减小甚至消除指令间的重叠度</p>
<ol>
<li>数据相关表明存在冒险的可能</li>
<li>数据相关决定了必须遵循的执行顺序</li>
<li>数据相关决定了可以达到并行度的上限</li>
</ol>
<h4 id="名字相关"><a href="#名字相关" class="headerlink" title="名字相关"></a>名字相关</h4><p>名字相关发生在使用<strong>相同存储器或存储单元（称为名字）</strong>的两条指令之间，但名字相关的指令间不存在数据流，名字相关有两种类型（假设指令i位于指令j之前）：</p>
<ol>
<li><strong>反相关</strong> 指令i读一个寄存器或存储单元，而指令j写该寄存器或存储单元，必须保护原始的指令执行顺序。</li>
<li><strong>输出相关</strong> 指令i和指令j写相同的寄存器时，为了保证该寄存器的值最后是由指令j写入的，必须保护指令的执行顺序。</li>
</ol>
<h4 id="控制相关"><a href="#控制相关" class="headerlink" title="控制相关"></a>控制相关</h4><p>控制相关决定了于转移指令有关的指令的执行顺序，从而使与转移有关的指令只在应当被执行时按程序顺序执行</p>
<p><strong>最简单的例子</strong></p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">if</span> <span class="built_in">p1</span> &#123;</div><div class="line">	<span class="built_in">S1</span><span class="comment">;</span></div><div class="line">&#125;</div><div class="line"><span class="symbol">if</span> <span class="built_in">p2</span> &#123;</div><div class="line">	<span class="built_in">S2</span><span class="comment">;</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>两类限制</strong></p>
<ol>
<li>与某一转移相关的指令不能被移动到该转移之前，这样的移动会使指令的执行不再受控于该转移，比如不能将if语句的then 部分中的指令移动到if语句之前</li>
<li>与某一转移相关的指令不能被移动到该转移之后，这样的移动会使指令的执行受到该转移的控制，不能将if语句之前的指令移动到受控于该if语句的then部分中</li>
</ol>
<h4 id="数据冒险"><a href="#数据冒险" class="headerlink" title="数据冒险"></a>数据冒险</h4><p>依据指令读写顺序，数据冒险可以分为三类，<strong>写后读、写后写、读后写</strong></p>
<ul>
<li><strong>写后读（RAW）</strong></li>
</ul>
<p>J试图在i写一个数据之前读取它，这时j将错误地读出旧值，RAW是最常见的冒险类型，它对应于真实的数据相关</p>
<ul>
<li><strong>写后写（WAW）</strong></li>
</ul>
<p>J试图在i写一个数据之前写该数据，这时，如果执行顺序错误，那么当写操作结束时，留下的值将是i写的结果，而程序的本意是留下j写的值</p>
<ul>
<li><strong>读后写（WAR）</strong></li>
</ul>
<p>J试图在i读一个数据之前写该数据，这时，i将错误地读出新值，这类冒险是由反相关引起的。 WAR不会发生在静态流水线中，因为在静态流水线中，所以的读操作发生的早，写操作发生的晚。只有在指令流水过程中一些指令的写操 作提前完成、或者其他指令的读操作滞后完成、或者指令顺序被改变的情况下，才会发生WAR冒险</p>
<h3 id="支持指令级并行的基本编译技术"><a href="#支持指令级并行的基本编译技术" class="headerlink" title="支持指令级并行的基本编译技术"></a>支持指令级并行的基本编译技术</h3><h4 id="基本流水线调度"><a href="#基本流水线调度" class="headerlink" title="基本流水线调度"></a>基本流水线调度</h4><p>为了避免流水线停顿，要去发现可以流水重叠的不相关的指令序列，将指令代码中相关的指令加以分离，使其相隔的时钟周期能正好等于原来指令在流水执行时的时延。编译器进行这类调度的能力既依赖于程序的指令级并行度，也依赖于流水线中功能单元的时延。</p>
<h3 id="循环展开"><a href="#循环展开" class="headerlink" title="循环展开"></a>循环展开</h3><p>循环展开可以增加有效操作对转移和开销指令的比重，展开可以通过<strong>多次复制循环体和调整循环中止代码</strong>来实现。</p>
<p>循环展开也可以用来改进调度的效果，由于它消除了转移，因此来自不同迭代的指令可以被一起调度，可以在迭代内加入不相关的指令来消除数据相关引起的停顿。</p>
<ol>
<li>如果迭代之间是互不相关的，则可以判定循环展开是有意义的</li>
<li>为不同的计算使用相同的寄存器会引起额外的限制，需要使用不同的寄存器来避免这类限制</li>
<li>消除额外的测试和转移指令，调整循环终止和迭代代码</li>
<li>如果来自不同循环体的load和store是互不相关的，则可以在循环展开中将两者交换</li>
<li>调度代码，保持相关性，确保与原始代码结果相同</li>
</ol>
<p><strong>循环展开的效果受制于三因素</strong>：展开使额外开销降低、代码量的大小和编译器的限制。</p>
<p>循环展开次数越多，则额外开销的时钟周期越小；代码量的增长，特别是在规模较大的循环中，当代码量的增长使指令Cache的缺失率增加时，这类问题就更加明显；如果将展开和大规模调度相结合，寄存器不足是一个亟待解决的问题，特别是在多发射处理器中，由于要重叠执行更多的独立指令序列，寄存器不足带来的挑战更为严峻</p>
<p>循环展开对<strong>简单流水线、超标量多发射结构、VLIW</strong>均适用</p>
<h3 id="采用预测技术减小转移开销"><a href="#采用预测技术减小转移开销" class="headerlink" title="采用预测技术减小转移开销"></a>采用预测技术减小转移开销</h3><p>是另一种方法来降低分支的性能损失</p>
<p><strong>相关预测:</strong> 利用其它分支行为来进行预测的分支预测器</p>
<h3 id="采用动态调度克服数据冒险"><a href="#采用动态调度克服数据冒险" class="headerlink" title="采用动态调度克服数据冒险"></a>采用动态调度克服数据冒险</h3><p><strong>动态调度</strong> 通过硬件对指令执行顺序进行重组，在保持数据流和异常行为的同时减少停顿。</p>
<p><strong>优点:</strong> 可以处理一些在编译阶段无法预见的相关情况，如存储器引用等，同时它简化了编译器的设计。更重要的是，它可以在等待时执行一些其他的代码，允许在别的流水线机器上编译的指令在不同的流水线上有效地运行</p>
<p><strong>缺点:</strong> 动态调度会使硬件复杂度显著增加。</p>
<p><strong>和静态流水线调度的区别</strong> 动态调度虽然不能改变数据流，但它会在相关性出现时尽力避免停顿，而由编译器执行的静态流水线调度则是将相关指令分离，使它们不再引起冒险，从而将停顿减至最小。</p>
<p><strong>乱序执行</strong>：指令的发射仍采用按序的方式，但指令在它的操作数可用时马上开始执行，流水线采用乱序执行使得指令的结束也是乱序的，乱序执行会产生WAR和WAW冒险。指令的乱序完成会使异常处理变得复杂，异常行为必须保护，以确保除严格按照程序顺序执行时出现的异常之外，不会出现新的异常。即使异常行为被保护，动态调度也会产生一些不精确的异常。</p>
<p><strong>不精确异常：</strong> 是指当产生异常时，处理器的状态与严格按照程序顺序执行时的处理器状态不同，不精确异常的发生有两种可能：<strong>1、异常指令执行之前，流水线提前完成了后面的指令2、异常指令完成之前，流水线还没有完成前面的指令</strong></p>
<p>为了实现乱序执行，需要将五级流水线的ID流水阶段分割为以下两个部分：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">发射 译码指令，检测结构冒险</div><div class="line">读操作数 等到不存在数据冒险时读操作数。在动态调度流水线中，所有的指令在发射阶段都是按序发射，但在读操作数阶段，则可能产生停顿，即进入乱序执行。</div></pre></td></tr></table></figure>
<h4 id="用Tomasulo方法进行动态调度"><a href="#用Tomasulo方法进行动态调度" class="headerlink" title="用Tomasulo方法进行动态调度"></a>用Tomasulo方法进行动态调度</h4><h5 id="说人话"><a href="#说人话" class="headerlink" title="说人话"></a>说人话</h5><p>事实上就是顺序开始执行指令，然后顺位靠后的指令如果还没执行完，就找个地方(保留站)把结果放起来，等到前面的指令完成了再进如下一步。</p>
<h5 id="官方解释"><a href="#官方解释" class="headerlink" title="官方解释"></a>官方解释</h5><p>通过对操作数何时可用进行跟踪以<strong>减少RAW冒险</strong>，通过引入寄存器<strong>重命名</strong>减少<strong>WAW和WAR冒险</strong>(寄存器重命名是指通过重命名所有的目标寄存器，包括指令序列中<strong>位置靠前</strong>的指令<strong>将要读和写的寄存器</strong>)。该方法的改进版本的共同特点是通过跟踪指令的相关性使指令在操作数可用时立即开始执行，通过寄存器重命名减少数据冒险</p>
<p><strong>保留站</strong>：在Tomasulo算法中，寄存器重命名是通过保留站实现的，<strong>保留站为等待发射的指令保存操作数</strong>。基本思想是：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">当操作数可用时，保留站马上取操作数并将其缓存，从而避免从寄存器中读操作数；</div><div class="line">即将执行的指令指定保留站为其提供数据输入；</div><div class="line">当对寄存器的后续写操作在执行过程中发生重叠时，只允许最后一个实际更新寄存器。在指令被发射后，它所需要的操作数所对应的寄存器被重命名为保留站的名字</div></pre></td></tr></table></figure>
<h1 id="数据级并行"><a href="#数据级并行" class="headerlink" title="数据级并行"></a>数据级并行</h1><h1 id="线程级并行"><a href="#线程级并行" class="headerlink" title="线程级并行"></a>线程级并行</h1><h1 id="请求级并行"><a href="#请求级并行" class="headerlink" title="请求级并行"></a>请求级并行</h1>
    

    
</div>


                

                <!-- Post Comments -->
                
                    
    <!-- 使用多说评论 -->
    <link rel="stylesheet" href="/css/duoshuo.min.css">
<style>
    #ds-thread #ds-reset .ds-post-button{
        background-color: #0097A7 !important;
    }
    #ds-wrapper #ds-reset .ds-icons-32{
        background-color: #0097A7 !important;
    }
    #ds-reset .ds-highlight {
        color: #0097A7 !important;
    }
</style>
<div id="comments">
    <!-- 多说评论框 start -->
    <div class="ds-thread"
        data-thread-key=""
        data-url="http://pengtianhao.com/2017/04/12/计算机系统结构笔记/"
        data-title="计算机系统结构笔记">
    </div>
    <!-- 多说评论框 end -->
</div>





                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2017/04/06/在南极旅行是怎样的体验/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/head.jpg" alt="彭天浩's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        pengtianhao48@gmail.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="mailto:pengtianhao48@gmail.com" target="_blank" title="Email Me">
                        <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    <li id="sidebar-first-li">
        <a href="/" target="_self">
            <i class="material-icons sidebar-material-icons">home</i>
            主页
        </a>
    </li>

    <!-- I'm Feeling Lucky -->
    <!--
    <li class="dropdown">
        <a href="" target="_self">
            <i class="material-icons sidebar-material-icons">explore</i>
             sidebar.imlucky
        </a>
    </li>
    -->

    <!-- Archives  -->
    <li class="dropdown">
        <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
            <i class="material-icons sidebar-material-icons">inbox</i>
             归档
            <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
            <li>
            <a class="sidebar_archives-link" href="/archives/2017/04/">四月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/03/">三月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/01/">一月 2017<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/11/">十一月 2016<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/10/">十月 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/09/">九月 2016<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/08/">八月 2016<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/06/">六月 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/04/">四月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/03/">三月 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/01/">一月 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/12/">十二月 2015<span class="sidebar_archives-count">2</span></a>
        </ul>
    </li>

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                分类
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/MacOS/">MacOS<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/Python/">Python<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/categories/iOS/">iOS<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/categories/创业/">创业<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/categories/杂烩/">杂烩<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/科技文章/">科技文章<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/英语/">英语<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/categories/计算机基础/">计算机基础<span class="sidebar_archives-count">11</span></a></li><li><a class="sidebar_archives-link" href="/categories/转载/">转载<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/categories/随感/">随感<span class="sidebar_archives-count">2</span></a>
            </ul>
        </li>
    

    <!-- Divider -->
    <li class="divider"></li>


    <!-- Pages  -->
  	
        <li>
            <a href="/about" title="关于">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                关于
            </a>
        </li>
  	

    <!-- Article Numebr  -->
    <li>
        <a href="/archives">
            文章总数
            <span class="sidebar-badge">29</span>
        </a>
    </li>
</ul>


        <!-- Sidebar Divider -->
        <div class="sidebar-divider"></div>

        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Theme Material -->
<a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
    <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
        主题 - Material
        <span class="sidebar-badge badge-circle">i</span>
    </div>
</a>

<!-- Help & Support -->
<!--
<a href="mailto:hiviosey@gmail.com" class="sidebar-footer-text-a">
    <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
    sidebar.help
    <span class="mdl-button__ripple-container">
      <span class="mdl-ripple"></span>
    </span>
  </div>
</a>
-->

<!-- Feedback -->
<!--
<a href="https://github.com/viosey/hexo-theme-material/issues" target="_blank" class="sidebar-footer-text-a">
    <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
         sidebar.feedback
                    <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></div>
</a>
-->

<!-- Abount Theme -->
<!--
<a href="https://blog.viosey.com/index.php/Material.html" target="_blank" class="sidebar-footer-text-a">
    <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
         sidebar.about_theme
        <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></div>
</a>-->

    </div>

    <!-- Sidebar Sponsor -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
        <a href="https://twitter.com/twitter" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-twitter.png);">
                <span class="visuallyhidden">Twitter</span>
            </button><!--
     --></a>
    

    <!-- Facebook -->
    
        <a href="https://www.facebook.com/tim.peng.378" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-facebook.png);">
                <span class="visuallyhidden">Facebook</span>
            </button><!--
     --></a>
    

    <!-- Google + -->
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://github.com/pthtc" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-github.png);">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    
        <a href="https://www.zhihu.com/people/peng-tian-hao-23/activities" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-zhihu.png);">
                <span class="visuallyhidden">Zhihu</span>
            </button><!--
     --></a>
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;
            <script type="text/javascript">
                var fd = new Date();
                document.write(fd.getFullYear());
            </script>
            &nbsp;彭天浩的博客
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import File -->
<script src="/js/highlight.min.js"></script>
<script src="/js/js.min.js"></script>
<script src="/js/nprogress.js"></script>

<script type="text/javascript">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();

    $('#nprogress .bar').css({
        'background': '#FF4081'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #FF4081, 0 0 15px #FF4081'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#FF4081',
        'border-left-color': '#FF4081'
    });

    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>







    <!-- Busuanzi -->
    <script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



    <!-- 多说公共 js 代码 start -->
    <script type="text/javascript">
        var duoshuoQuery = {
            short_name: 'pengtianhao'
        };
        (function() {
            var ds = document.createElement('script');
            ds.type = 'text/javascript';
            ds.async = true;
            ds.src = 'https://static.duoshuo.com/embed.js';
            ds.charset = 'UTF-8';
            (document.getElementsByTagName('head')[0]
             || document.getElementsByTagName('body')[0]).appendChild(ds);
        })();
    </script>
    <!-- 多说公共 js 代码 end -->





<!-- Swiftye -->


<!-- Local Search-->

    <script>
    var searchFunc = function(path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: 'xml',
            success: function( xmlResponse ) {
                // get the contents from search data
                var datas = $( 'entry', xmlResponse ).map(function() {
                    return {
                        title: $( 'title', this ).text(),
                        content: $('content',this).text(),
                        url: $( 'url' , this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function() {
                    var str='<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function(data) {
                        var isMatch = true;
                        var content_index = [];
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                        var data_url = data.url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if(data_title != '' && data_content != '') {
                            keywords.forEach(function(keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if( index_title < 0 && index_content < 0 ) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += '<li><a href="'+ data_url +'" class="search-result-title" target="_blank">'+ data_title;
                            var content = data.content.trim().replace(/<[^>]+>/g, '');
                            if (first_occur >= 0) {
                                // cut out characters
                                var start = first_occur - 6;
                                var end = first_occur + 6;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 10;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function(keyword) {
                                    var regS = new RegExp(keyword, 'gi');
                                    match_content = match_content.replace(regS, '<em class="search-keyword">'+keyword+'</em>');
                                })
                                str += '<p class="search-result">' + match_content +'...</p>' +'</a>';
                            }
                        }
                    });
                    $resultContent.innerHTML = str;
                });
            }
        });
    }
</script>


    <script>
        var inputArea = document.querySelector('#search');
        var getSearchFile = function() {
            var path = 'search.xml';
            searchFunc(path, 'search', 'local-search-result');
        }

        if(inputArea) {
            inputArea.onfocus = function() {
                getSearchFile();
            }
        }
    </script>


<!-- Window Load-->
<script>
    $(window).load(function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });
</script>

<!-- MathJax Load-->


                </main>
            </div>
        </body>
    
</html>
